# Converted from Atomic Red Team - Command and Scripting Interpreter: Windows Command Shell
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1059.003
# Original auto_generated_guid: 00682c9f-7df4-4df8-950b-6dcaaa3ad9af

---
api_version: 2.0
uuid: c2efc5f5-d94c-487b-8d8b-f7ce261a5b7f
name: Command prompt writing script to file then executes it
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Simulate DarkGate malware's second stage by writing a VBscript to disk directly from the command prompt then executing it.
  The script will execute 'whoami' then exit.

mitre:
  tactics:
    - "TA0002 Execution"
  techniques:
    - "T1059 Command and Scripting Interpreter"
  subtechniques:
    - "T1059.003 Windows Command Shell"

requirements:
  platforms:
    - os: windows
  superuser: true

args:
  - name: script_path
    description: Path in which the script will be written
    type: path
    default: "C:\\Users\\Public"
  - name: script_name
    description: Script name (without the extension)
    type: string
    default: "AtomicTest"

steps:
  - name: write_and_execute_vbscript
    executor: cmd.exe
    inline: |
      cmd /c cd /d {{.Args.script_path}} & echo Set objShell = CreateObject("WScript.Shell"):Set objExec = objShell.Exec("whoami"):Set objExec = Nothing:Set objShell = Nothing > {{.Args.script_path}}/{{.Args.script_name}}.vbs & {{.Args.script_path}}/{{.Args.script_name}}.vbs
    cleanup:
      inline: |
        rm "{{.Args.script_path}}/{{.Args.script_name}}.vbs"
