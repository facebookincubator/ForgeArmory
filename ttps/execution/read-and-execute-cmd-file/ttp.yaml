# Converted from Atomic Red Team - Command and Scripting Interpreter: Windows Command Shell
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1059.003
# Original auto_generated_guid: df81db1b-066c-4802-9bc8-b6d030c3ba8e

---
api_version: 2.0
uuid: 39da7838-c1e5-4588-8b30-7f0f9363d9e1
name: Command Prompt read contents from CMD file and execute
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Simulate Raspberry Robin using the "standard-in" command prompt feature cmd `/R <` to read and execute a file via cmd.exe
  See https://redcanary.com/blog/raspberry-robin/.

mitre:
  tactics:
    - "TA0002 Execution"
  techniques:
    - "T1059 Command and Scripting Interpreter"
  subtechniques:
    - "T1059.003 Windows Command Shell"

requirements:
  platforms:
    - os: windows

args:
  - name: input_file
    description: CMD file that is read by Command Prompt and execute, which launches calc.exe
    type: path
    default: "./t1059.003_cmd.cmd"

steps:
  - name: ensure_cmd_file_exists
    executor: powershell
    inline: |
      if (-not (Test-Path "{{.Args.input_file}}")) {
        Write-Error "CMD file not found at {{.Args.input_file}}. Exiting..."
        exit 1
      }

  - name: execute_cmd_via_stdin
    executor: cmd.exe
    inline: |
      cmd /r cmd<"{{.Args.input_file}}"
