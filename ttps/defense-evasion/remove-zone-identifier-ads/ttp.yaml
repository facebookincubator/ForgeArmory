# Converted from Atomic Red Team - Subvert Trust Controls: Mark-of-the-Web Bypass
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1553.005
# Original auto_generated_guid: 64b12afc-18b8-4d3f-9eab-7f6cae7c73f9

---
api_version: 2.0
uuid: 57aad2ef-68fa-4cce-a511-2481c9b8070d
name: Remove the Zone.Identifier alternate data stream
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.
  Removing this allows more freedom in executing scripts in PowerShell and avoids opening files in protected view.

mitre:
  tactics:
    - "TA0005 Defense Evasion"
  techniques:
    - "T1553 Subvert Trust Controls"
  subtechniques:
    - "T1553.005 Mark-of-the-Web Bypass"

requirements:
  platforms:
    - os: windows
  superuser: false

args:
  - name: file_to_download
    description: File to download and have the Zone.Identifier removed
    type: string
    default: "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/dd526047b8c399c312fee47d1e6fb531164da54d/LICENSE.txt"
  - name: file_path
    description: File to have the Zone.Identifier removed
    type: path
    default: "C:\\Users\\Public\\malicious.bin"

steps:
  - name: ensure_test_file_exists
    executor: powershell
    inline: |
      Invoke-WebRequest {{.Args.file_to_download}} -OutFile {{.Args.file_path}}
      Set-Content -Path {{.Args.file_path}} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'
    cleanup:
      executor: powershell
      inline: |
        Remove-Item {{.Args.file_path}} -ErrorAction Ignore

  - name: remove_zone_identifier
    executor: powershell
    inline: |
      Unblock-File -Path {{.Args.file_path}}
    cleanup:
      executor: powershell
      inline: |
        Set-Content -Path {{.Args.file_path}} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'
