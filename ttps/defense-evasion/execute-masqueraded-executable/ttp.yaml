# Converted from Atomic Red Team - Masquerading: Match Legitimate Name or Location
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1036.005
# Original auto_generated_guid: 35eb8d16-9820-4423-a2a1-90c4f5edd9ca

---
api_version: 2.0
uuid: 48c80aee-5ca9-4549-896a-ed17c27fc731
name: Masquerade as a built-in system executable
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Launch an executable that attempts to masquerade as a legitimate executable.

mitre:
  tactics:
    - "TA0005 Defense Evasion"
  techniques:
    - "T1036 Masquerading"
  subtechniques:
    - "T1036.005 Match Legitimate Name or Location"

requirements:
  platforms:
    - os: windows
  superuser: false

args:
  - name: executable_filepath
    description: File path where the generated executable will be dropped and executed from. The filename should be the name of a built-in system utility.
    type: path
    default: "C:\\Users\\Public\\svchost.exe"

steps:
  - name: create_and_execute_masqueraded_executable
    executor: powershell
    inline: |
      Add-Type -TypeDefinition @'
      public class Test {
          public static void Main(string[] args) {
              System.Console.WriteLine("tweet, tweet");
          }
      }
      '@ -OutputAssembly "{{.Args.executable_filepath}}"

      Start-Process -FilePath "{{.Args.executable_filepath}}"
    cleanup:
      executor: powershell
      inline: |
        Remove-Item -Path "{{.Args.executable_filepath}}" -ErrorAction Ignore
