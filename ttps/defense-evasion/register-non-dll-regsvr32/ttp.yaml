# Converted from Atomic Red Team - Signed Binary Proxy Execution: Regsvr32
# Source: https://www.atomicredteam.io/atomic-red-team/atomics/T1218.010
# Original auto_generated_guid: 1ae5ea1f-0a4e-4e54-b2f5-4ac328a7f421

---
api_version: 2.0
uuid: aa5ced60-2c6e-424a-a22a-c8dac27a7a95
name: Regsvr32 Registering Non DLL
authors:
  - isaac_fletcher
  - Atomic Red Team
description: |
  Replicating observed Gozi maldoc behavior registering a dll with an altered extension

mitre:
  tactics:
    - "TA0005 Defense Evasion"
  techniques:
    - "T1218 Signed Binary Proxy Execution"
  subtechniques:
    - "T1218.010 Regsvr32"

requirements:
  platforms:
    - os: windows
  superuser: false

args:
  - name: original_dll_path
    description: Path to original dll file to rename
    type: path
    default: "C:\\Windows\\System32\\shell32.dll"
  - name: renamed_dll_path
    description: Path to renamed dll file to be registered
    type: path
    default: "C:\\Users\\Public\\shell32.jpg"

steps:
  - name: ensure_renamed_dll_exists
    executor: cmd.exe
    inline: |
      copy "{{.Args.original_dll_path}}" "{{.Args.renamed_dll_path}}"
    cleanup:
      executor: cmd.exe
      inline: |
        del "{{.Args.renamed_dll_path}}"

  - name: register_non_dll_file
    executor: cmd.exe
    inline: |
      regsvr32.exe /s {{.Args.renamed_dll_path}}
    cleanup:
      executor: cmd.exe
      inline: |
        regsvr32.exe /U /s {{.Args.renamed_dll_path}}
