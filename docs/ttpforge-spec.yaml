---
TTP:
  type: object
  properties:
    name:
      type: string
    description:
      type: string
      required: true
    mitre:
      $ref: "#/definitions/Mitre"
    env:
      type: object
      additionalProperties:
        type: string
    steps:
      type: array
      items:
        type: object
        oneOf:
          - $ref: "#/definitions/FileStep"
          - $ref: "#/definitions/BasicStep"
          - $ref: "#/definitions/SubTTPStep"
          - $ref: "#/definitions/EditStep"
    args:
      type: array
      items:
        $ref: "#/definitions/Spec"

Act:
  type: object
  properties:
    if:
      type: string
    env:
      type: object
      additionalProperties:
        type: string
    name:
      type: string
      required: true
    outputs:
      type: object
      additionalProperties:
        $ref: "#/definitions/Spec"

Mitre:
  type: object
  properties:
    tactics:
      type: array
      items:
        type: string
    techniques:
      type: array
      items:
        type: string
    subtechniques:
      type: array
      items:
        type: string

FileStep:
  type: object
  properties:
    act:
      $ref: "#/definitions/Act"
    file:
      type: string
    executor:
      type: string
    cleanup:
      $ref: "#/definitions/CleanupAct"
    args:
      type: array
      items:
        type: string

BasicStep:
  type: object
  properties:
    act:
      $ref: "#/definitions/Act"
    executor:
      type: string
    inline:
      type: string
    args:
      type: array
      items:
        type: string
    cleanup:
      type: string

SubTTPStep:
  type: object
  properties:
    act:
      $ref: "#/definitions/Act"
    ttp:
      type: string
    args:
      type: object
      additionalProperties:
        type: string

Edit:
  type: object
  properties:
    old:
      type: string
    new:
      type: string
    regexp:
      type: boolean

EditStep:
  type: object
  properties:
    act:
      $ref: "#/definitions/Act"
    edit_file:
      type: string
    edits:
      type: array
      items:
        $ref: "#/definitions/Edit"
    backup_file:
      type: string

CleanupAct:
  type: object
  properties:
    if:
      type: string
    env:
      type: object
      additionalProperties:
        type: string
    name:
      type: string
      required: true
    outputs:
      type: object
      additionalProperties:
        type: array
        items:
          $ref: "#/definitions/Spec"

Spec:
  type: object
  properties:
    name:
      type: string
      required: true
    type:
      type: string
    default:
      type: string
    description:
      type: string
